<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pencarian Outlet Terdekat</title>
    <style>
      body {
        font-family: sans-serif;
        margin: 0;
        padding: 0;
        background-color: #f0f2f5;
        color: #333;
      }
      .container {
        max-width: 500px;
        margin: auto;
        background-color: #fff;
        padding: 25px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      h2 {
        text-align: center;
        color: #007bff;
        margin-bottom: 25px;
      }
      h4 {
        text-align: center;
        color: #dc3545;
        margin-bottom: 25px;
      }
      label {
        font-weight: bold;
        display: block;
        margin-bottom: 8px;
        color: #555;
      }
      select, input[type="text"], button {
        width: 100%;
        padding: 10px;
        margin-bottom: 20px;
        border: 1px solid #ccc;
        border-radius: 4px;
        box-sizing: border-box;
        font-size: 16px;
      }
      select:disabled, input[type="text"]:disabled {
        background-color: #e9ecef;
      }
      .radio-group {
        margin-bottom: 20px;
      }
      .radio-group label {
        display: inline-block;
        font-weight: normal;
        margin-right: 15px;
      }
      .radio-group input[type="radio"] {
        margin-right: 5px;
      }
      button {
        background-color: #007bff;
        color: white;
        font-weight: bold;
        cursor: pointer;
        transition: background-color 0.3s ease;
      }
      button:hover:not(:disabled) {
        background-color: #0056b3;
      }
      button:disabled {
        background-color: #cccccc;
        cursor: not-allowed;
      }
      
      /* CSS untuk Layout dan Sidebar */
      .sidebar {
        width: 220px;
        position: fixed;
        top: 0;
        left: -260px;
        height: 100%;
        background-color: #343a40;
        padding: 20px;
        box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
        color: white;
        transition: left 0.3s ease;
        z-index: 1001;
      }
      .sidebar.active {
        left: 0;
      }
      .main-content {
        padding: 20px;
        transition: margin-left 0.3s ease;
      }
      .sidebar h3 {
        margin-top: 0;
        color: white;
        font-size: 1.5em;
        margin-bottom: 20px;
      }
      .sidebar ul {
        list-style: none;
        padding: 0;
      }
      .sidebar ul li {
        margin-bottom: 10px;
      }
      .sidebar ul li a {
        color: white;
        text-decoration: none;
        display: block;
        padding: 10px;
        background-color: #495057;
        border-radius: 4px;
        transition: background-color 0.3s ease;
      }
      .sidebar ul li a:hover {
        background-color: #6c757d;
        text-decoration: none;
      }
      .overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        display: none;
      }
      
      /* CSS Khusus untuk Desktop */
      @media (min-width: 769px) {
        .sidebar {
          left: 0;
        }
        .main-content {
          margin-left: 220px;
        }
        .mobile-menu-icon {
          display: none;
        }
      }

      /* CSS Khusus untuk Mobile */
      @media (max-width: 768px) {
        .mobile-menu-icon {
          display: block;
          position: fixed;
          top: 10px;
          left: 10px;
          z-index: 1002;
          width: 40px;
          height: 40px;
          cursor: pointer;
          color: white;
          background: #007bff;
          border-radius: 5px;
          display: flex;
          justify-content: center;
          align-items: center;
          font-size: 1.5em;
          transition: transform 0.3s ease, background-color 0.3s ease;
        }
        .mobile-menu-icon.active {
          transform: rotate(90deg);
        }
        .main-content {
          padding-left: 50px; 
        }
      }
      
      /* CSS untuk tabel hasil pencarian */
      #outlet-list {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
      }
      #outlet-list th, #outlet-list td {
        border: 1px solid #ddd;
        padding: 8px;
        text-align: left;
      }
      #outlet-list th {
        background-color: #f2f2f2;
      }
      #outlet-list tbody tr:nth-child(even) {
        background-color: #f9f9f9;
      }

      /* Container untuk tabel responsif */
      .table-responsive {
          overflow-x: auto;
      }

      /* CSS untuk tabel agar konten tidak melebar */
      #outlet-list {
          min-width: 500px; /* Lebar minimum agar tabel tidak terlalu kecil di desktop */
      }
    </style>

    <script>
      function toggleSidebar() {
        const sidebar = document.getElementById('sidebar');
        const hamburgerIcon = document.querySelector('.mobile-menu-icon');
        const overlay = document.getElementById('overlay');
        
        sidebar.classList.toggle('active');
        hamburgerIcon.classList.toggle('active');
        
        overlay.style.display = sidebar.classList.contains('active') ? 'block' : 'none';
        
        if (sidebar.classList.contains('active')) {
          hamburgerIcon.innerHTML = 'X';
        } else {
          hamburgerIcon.innerHTML = '☰';
        }
      }

      function getLocation() {
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(showPosition, showError);
        } else {
          alert("Geolocation tidak didukung oleh browser ini.");
        }
      }

      function showPosition(position) {
        const latitude = position.coords.latitude;
        const longitude = position.coords.longitude;
        document.getElementById('latitude_pengguna').value = latitude;
        document.getElementById('longitude_pengguna').value = longitude;
        document.getElementById('find-button').disabled = false;
      }

      function showError(error) {
        switch(error.code) {
          case error.PERMISSION_DENIED:
            alert("Pengguna menolak permintaan Geolocation.");
            break;
          case error.POSITION_UNAVAILABLE:
            alert("Informasi lokasi tidak tersedia.");
            break;
          case error.TIMEOUT:
            alert("Permintaan lokasi pengguna telah habis waktu.");
            break;
          case error.UNKNOWN_ERROR:
            alert("Terjadi kesalahan yang tidak diketahui.");
            break;
        }
      }

      function findOutlets() {
        const userLat = parseFloat(document.getElementById('latitude_pengguna').value);
        const userLng = parseFloat(document.getElementById('longitude_pengguna').value);
        
        if (isNaN(userLat) || isNaN(userLng)) {
          alert("Harap ambil lokasi Anda terlebih dahulu.");
          return;
        }

        document.getElementById('find-button').disabled = true;
        document.getElementById('find-button').innerText = 'Mencari...';

        google.script.run
          .withSuccessHandler(displayOutlets)
          .withFailureHandler(function(error) {
            alert("Terjadi kesalahan: " + error);
            document.getElementById('find-button').disabled = false;
            document.getElementById('find-button').innerText = 'Cari Outlet Terdekat';
          })
          .findNearestOutlets(userLat, userLng);
      }

      function displayOutlets(outlets) {
        const tableBody = document.getElementById('outlet-list-body');
        tableBody.innerHTML = '';
        
        outlets.forEach((outlet, index) => {
          const row = `
            <tr>
              <td>${index + 1}</td>
              <td>${outlet.outletId}</td>
              <td>${outlet.namaOutlet}</td>
              <td>${outlet.cluster}</td>
              <td>${outlet.distance} m</td>
            </tr>
          `;
          tableBody.innerHTML += row;
        });

        document.getElementById('find-button').disabled = false;
        document.getElementById('find-button').innerText = 'Cari Outlet Terdekat';
      }
    </script>

  </head>
  <body>
    <div class="mobile-menu-icon" onclick="toggleSidebar()">☰</div>
    <?!= include('sidebar'); ?>
    <div id="overlay" onclick="toggleSidebar()"></div>
    <div class="main-content">
      <div class="container">
        <h2>Pencarian Outlet Terdekat</h2>
        <button onclick="getLocation()">Ambil Lokasi</button>

        <label for="longitude_pengguna">Longitude Pengguna:</label>
        <input type="text" id="longitude_pengguna" disabled>

        <label for="latitude_pengguna">Latitude Pengguna:</label>
        <input type="text" id="latitude_pengguna" disabled>


        <button id="find-button" onclick="findOutlets()" disabled>Cari Outlet Terdekat</button>

        <div class="table-responsive">
          <table id="outlet-list">
            <thead>
              <tr>
                <th>No</th>
                <th>Outlet ID</th>
                <th>Nama Outlet</th>
                <th>Cluster</th>
                <th>Jarak (m)</th>
              </tr>
            </thead>
            <tbody id="outlet-list-body">
              </tbody>
          </table>
        </div>
      </div>
    </div>
  </body>
</html>
